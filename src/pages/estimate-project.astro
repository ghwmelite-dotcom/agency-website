---
import BaseLayout from '@/layouts/BaseLayout.astro';
import Header from '@/components/Header.astro';
import Footer from '@/components/Footer.astro';
---

<BaseLayout title="AI Project Estimator - Get Instant Estimates" description="Get instant AI-powered project estimates with cost, timeline, and technology recommendations">
  <Header />
  <main class="estimator-page">
  <div class="estimator-container">
    <div class="container-narrow">
      <!-- Hero Section -->
      <div class="hero-section">
        <div class="ai-badge">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M13 10V3L4 14h7v7l9-11h-7z"/>
          </svg>
          AI-Powered Estimation
        </div>
        <h1 class="page-title">
          Get Your Project Estimate
          <span class="title-highlight">Instantly</span>
        </h1>
        <p class="page-subtitle">
          Describe your project and receive a comprehensive AI-powered analysis including cost estimates, timeline, technology recommendations, and team requirements.
        </p>
      </div>

      <!-- Progress Indicator -->
      <div class="progress-container">
        <div class="progress-wrapper">
          <div class="progress-step-wrapper">
            <div class="step-indicator active" data-step="1">
              <div class="step-number">1</div>
              <div class="step-label">Your Info</div>
            </div>
            <div class="step-line"></div>
          </div>
          <div class="progress-step-wrapper">
            <div class="step-indicator" data-step="2">
              <div class="step-number">2</div>
              <div class="step-label">Project Details</div>
            </div>
            <div class="step-line"></div>
          </div>
          <div class="progress-step-wrapper progress-step-last">
            <div class="step-indicator" data-step="3">
              <div class="step-number">3</div>
              <div class="step-label">Preferences</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Form Container -->
      <div class="form-container">
        <form id="estimateForm">
          <!-- Step 1: Basic Info -->
          <div class="form-step active" data-step="1">
            <h2 class="form-section-title">Let's start with your information</h2>

            <div class="form-grid">
              <div class="form-group">
                <label for="name" class="form-label">
                  Full Name <span class="required">*</span>
                </label>
                <input
                  type="text"
                  id="name"
                  name="name"
                  required
                  class="form-input"
                  placeholder="John Doe"
                />
              </div>

              <div class="form-group">
                <label for="email" class="form-label">
                  Email Address <span class="required">*</span>
                </label>
                <input
                  type="email"
                  id="email"
                  name="email"
                  required
                  class="form-input"
                  placeholder="john@company.com"
                />
              </div>

              <div class="form-group">
                <label for="company" class="form-label">
                  Company Name
                </label>
                <input
                  type="text"
                  id="company"
                  name="company"
                  class="form-input"
                  placeholder="Acme Inc."
                />
              </div>

              <div class="form-group">
                <label for="phone" class="form-label">
                  Phone Number
                </label>
                <input
                  type="tel"
                  id="phone"
                  name="phone"
                  class="form-input"
                  placeholder="+1 (555) 123-4567"
                />
              </div>
            </div>

            <div class="form-actions">
              <button type="button" class="btn btn-primary next-btn">
                Next Step →
              </button>
            </div>
          </div>

          <!-- Step 2: Project Details -->
          <div class="form-step" data-step="2">
            <h2 class="form-section-title">Tell us about your project</h2>

            <div class="form-section">
              <div class="form-group-full">
                <label for="project_type" class="form-label">
                  Project Type <span class="required">*</span>
                </label>
                <div class="selection-grid">
                  <label class="project-type-card">
                    <input type="radio" name="project_type" value="web" required class="hidden" />
                    <div class="card-content">
                      <svg class="card-icon" width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                      </svg>
                      <span>Web App</span>
                    </div>
                  </label>

                  <label class="project-type-card">
                    <input type="radio" name="project_type" value="mobile" class="hidden" />
                    <div class="card-content">
                      <svg class="card-icon" width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" />
                      </svg>
                      <span>Mobile App</span>
                    </div>
                  </label>

                  <label class="project-type-card">
                    <input type="radio" name="project_type" value="both" class="hidden" />
                    <div class="card-content">
                      <svg class="card-icon" width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" />
                      </svg>
                      <span>Both</span>
                    </div>
                  </label>

                  <label class="project-type-card">
                    <input type="radio" name="project_type" value="other" class="hidden" />
                    <div class="card-content">
                      <svg class="card-icon" width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                      </svg>
                      <span>Other</span>
                    </div>
                  </label>
                </div>
              </div>

              <div class="form-group-full">
                <label for="project_description" class="form-label">
                  Project Description <span class="required">*</span>
                </label>
                <p class="form-hint">
                  Describe your project in detail. Include features, goals, target audience, and any specific requirements.
                </p>
                <textarea
                  id="project_description"
                  name="project_description"
                  required
                  rows="8"
                  class="form-textarea"
                  placeholder="Example: I need a mobile app for food delivery. Users should be able to browse restaurants, place orders, track delivery in real-time, and pay securely. The app needs to support both iOS and Android..."
                ></textarea>
                <div class="char-counter">
                  <span id="charCount">0</span> characters
                </div>
              </div>
            </div>

            <div class="form-actions form-actions-split">
              <button type="button" class="btn btn-secondary prev-btn">
                ← Previous
              </button>
              <button type="button" class="btn btn-primary next-btn">
                Next Step →
              </button>
            </div>
          </div>

          <!-- Step 3: Preferences -->
          <div class="form-step" data-step="3">
            <h2 class="form-section-title">Your preferences</h2>

            <div class="form-section">
              <div class="form-group-full">
                <label class="form-label">
                  Timeline Preference <span class="required">*</span>
                </label>
                <div class="selection-grid">
                  <label class="timeline-card">
                    <input type="radio" name="timeline_preference" value="asap" required class="hidden" />
                    <div class="card-content">
                      <span>ASAP</span>
                    </div>
                  </label>

                  <label class="timeline-card">
                    <input type="radio" name="timeline_preference" value="1-3 months" class="hidden" />
                    <div class="card-content">
                      <span>1-3 Months</span>
                    </div>
                  </label>

                  <label class="timeline-card">
                    <input type="radio" name="timeline_preference" value="3-6 months" class="hidden" />
                    <div class="card-content">
                      <span>3-6 Months</span>
                    </div>
                  </label>

                  <label class="timeline-card">
                    <input type="radio" name="timeline_preference" value="6+ months" class="hidden" />
                    <div class="card-content">
                      <span>6+ Months</span>
                    </div>
                  </label>
                </div>
              </div>

              <div class="form-group-full">
                <label class="form-label">
                  Budget Range <span class="required">*</span>
                </label>
                <div class="selection-grid selection-grid-budget">
                  <label class="budget-card">
                    <input type="radio" name="budget_range" value="under 10k" required class="hidden" />
                    <div class="card-content">
                      <span class="budget-text">Under GH₵120k<br/>($10k)</span>
                    </div>
                  </label>

                  <label class="budget-card">
                    <input type="radio" name="budget_range" value="10k-25k" class="hidden" />
                    <div class="card-content">
                      <span class="budget-text">GH₵120k - 300k<br/>($10k - $25k)</span>
                    </div>
                  </label>

                  <label class="budget-card">
                    <input type="radio" name="budget_range" value="25k-50k" class="hidden" />
                    <div class="card-content">
                      <span class="budget-text">GH₵300k - 600k<br/>($25k - $50k)</span>
                    </div>
                  </label>

                  <label class="budget-card">
                    <input type="radio" name="budget_range" value="50k-100k" class="hidden" />
                    <div class="card-content">
                      <span class="budget-text">GH₵600k - 1.2M<br/>($50k - $100k)</span>
                    </div>
                  </label>

                  <label class="budget-card">
                    <input type="radio" name="budget_range" value="100k+" class="hidden" />
                    <div class="card-content">
                      <span class="budget-text">GH₵1.2M+<br/>($100k+)</span>
                    </div>
                  </label>
                </div>
              </div>
            </div>

            <div class="form-actions form-actions-split">
              <button type="button" class="btn btn-secondary prev-btn">
                ← Previous
              </button>
              <button type="submit" id="submitBtn" class="btn btn-primary btn-submit">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                </svg>
                Generate Estimate
              </button>
            </div>
          </div>
        </form>

        <!-- Loading State -->
        <div id="loadingState" class="hidden text-center py-12">
          <div class="relative">
            <div class="animate-spin rounded-full h-20 w-20 border-b-2 border-purple-500 mx-auto"></div>
            <div class="absolute inset-0 flex items-center justify-center">
              <svg width="40" height="40" class="text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
              </svg>
            </div>
          </div>
          <h3 class="text-2xl font-bold text-white mt-6 mb-2">Analyzing Your Project</h3>
          <p class="text-gray-400 mb-4">Our AI is carefully reviewing your requirements...</p>
          <div class="max-w-md mx-auto bg-gray-700 rounded-full h-2 overflow-hidden">
            <div id="progressBar" class="bg-gradient-to-r from-purple-500 to-blue-500 h-full rounded-full transition-all duration-500" style="width: 0%"></div>
          </div>
          <p id="progressText" class="text-sm text-gray-400 mt-2">Initializing...</p>
        </div>

        <!-- Results Display -->
        <div id="resultsContainer" class="hidden">
          <div class="text-center mb-8">
            <div class="inline-block mb-4">
              <svg width="48" height="48" class="text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
            <h2 class="text-3xl font-bold text-white mb-2">Your Project Estimate is Ready!</h2>
            <p class="text-gray-400">Here's what our AI analysis suggests for your project</p>
          </div>

          <!-- Cost Estimate -->
          <div class="bg-gradient-to-r from-purple-900/50 to-blue-900/50 rounded-xl p-6 mb-6 border border-purple-500/30">
            <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
              <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              Estimated Investment
            </h3>
            <div class="flex items-baseline gap-2">
              <span class="text-5xl font-bold bg-gradient-to-r from-purple-400 to-blue-400 text-transparent bg-clip-text" id="costRange">
                $0 - $0
              </span>
            </div>
          </div>

          <div class="grid md:grid-cols-2 gap-6 mb-6">
            <!-- Timeline -->
            <div class="bg-gray-700/50 rounded-xl p-6 border border-gray-600">
              <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                <svg width="20" height="20" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                Timeline
              </h3>
              <p class="text-3xl font-bold text-purple-400" id="timeline">0 weeks</p>
            </div>

            <!-- Team Size -->
            <div class="bg-gray-700/50 rounded-xl p-6 border border-gray-600">
              <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                <svg width="20" height="20" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                </svg>
                Team Size
              </h3>
              <p class="text-3xl font-bold text-blue-400" id="teamSize">0 people</p>
            </div>
          </div>

          <!-- Technology Stack -->
          <div class="bg-gray-700/50 rounded-xl p-6 border border-gray-600 mb-6">
            <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
              <svg width="20" height="20" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
              </svg>
              Recommended Technology Stack
            </h3>
            <div id="techStack" class="flex flex-wrap gap-2"></div>
          </div>

          <!-- Risk Assessment -->
          <div class="bg-gray-700/50 rounded-xl p-6 border border-gray-600 mb-6">
            <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
              <svg width="20" height="20" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
              </svg>
              Risk Level
            </h3>
            <div id="riskLevel"></div>
          </div>

          <!-- AI Analysis -->
          <div class="bg-gray-700/50 rounded-xl p-6 border border-gray-600 mb-6">
            <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
              <svg width="20" height="20" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
              </svg>
              Detailed Analysis
            </h3>
            <div id="aiAnalysis" class="text-gray-300 prose prose-invert max-w-none"></div>
          </div>

          <!-- CTA Section -->
          <div class="cta-section">
            <h3 class="cta-title">Ready to Get Started?</h3>
            <p class="cta-subtitle">
              Let's discuss your project in detail and turn this estimate into reality.
            </p>
            <div class="cta-buttons">
              <a
                href="/contact"
                class="cta-btn cta-btn-primary"
              >
                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                </svg>
                Schedule a Consultation
              </a>
              <button
                id="downloadPdfBtn"
                class="cta-btn cta-btn-download"
              >
                <svg width="20" height="20" class="download-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                Download PDF
              </button>
            </div>
          </div>

          <div class="text-center mt-8">
            <button
              id="newEstimateBtn"
              class="new-estimate-btn"
            >
              <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
              </svg>
              Start a New Estimate
            </button>
          </div>
        </div>
      </div>

      <!-- Trust Indicators -->
      <div class="mt-12 text-center">
        <p class="text-gray-400 text-sm mb-4">Trusted by innovative companies worldwide</p>
        <div class="flex justify-center items-center gap-8 text-gray-500">
          <div class="flex items-center gap-2">
            <svg width="20" height="20" class="w-5 h-5 text-green-500" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
            </svg>
            <span class="text-sm">SSL Secured</span>
          </div>
          <div class="flex items-center gap-2">
            <svg width="20" height="20" class="w-5 h-5 text-purple-500" fill="currentColor" viewBox="0 0 20 20">
              <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z" />
            </svg>
            <span class="text-sm">GDPR Compliant</span>
          </div>
          <div class="flex items-center gap-2">
            <svg width="20" height="20" class="w-5 h-5 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
            </svg>
            <span class="text-sm">AI-Powered</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  </main>
  <Footer />

  <style>
    /* Page Layout */
    .estimator-page {
      background: var(--color-bg);
      min-height: 100vh;
      padding-top: calc(var(--header-height) + 2rem);
    }

    .estimator-container {
      padding: 2rem 1rem 4rem;
    }

    .container-narrow {
      max-width: 900px;
      margin: 0 auto;
    }

    /* Hero Section */
    .hero-section {
      text-align: center;
      margin-bottom: 3rem;
    }

    .ai-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
      border: 1px solid rgba(102, 126, 234, 0.2);
      border-radius: var(--radius-full);
      color: var(--color-primary);
      font-size: 0.875rem;
      font-weight: 600;
      margin-bottom: 1rem;
    }

    .page-title {
      font-size: clamp(2rem, 5vw, 2.5rem);
      font-weight: 800;
      line-height: 1.2;
      margin-bottom: 1rem;
      color: var(--color-text);
    }

    .title-highlight {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .page-subtitle {
      font-size: 1.125rem;
      line-height: 1.6;
      color: var(--color-text-muted);
      max-width: 700px;
      margin: 0 auto;
    }

    /* Progress Container */
    .progress-container {
      margin-bottom: 3rem;
    }

    .progress-wrapper {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      max-width: 600px;
      margin: 0 auto;
    }

    .progress-step-wrapper {
      flex: 1;
      display: flex;
      align-items: flex-start;
    }

    .progress-step-last {
      flex: 0;
      justify-content: flex-end;
    }

    @media (max-width: 640px) {
      .progress-wrapper {
        max-width: 100%;
      }

      .step-label {
        font-size: 0.75rem !important;
      }
    }

    /* Step Indicator Styles */
    .step-indicator {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
    }

    .step-number {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: var(--color-surface);
      border: 2px solid var(--color-border);
      color: var(--color-text-muted);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.875rem;
      transition: all 0.3s ease;
      margin-bottom: 6px;
    }

    .step-indicator.active .step-number {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-color: transparent;
      color: white;
      box-shadow: 0 0 15px rgba(102, 126, 234, 0.4);
    }

    .step-indicator.completed .step-number {
      background: #10B981;
      border-color: transparent;
      color: white;
    }

    .step-label {
      font-size: 0.8125rem;
      color: var(--color-text-muted);
      font-weight: 500;
      white-space: nowrap;
    }

    .step-indicator.active .step-label {
      color: var(--color-primary);
      font-weight: 600;
    }

    .step-line {
      height: 2px;
      background: var(--color-border);
      flex: 1;
      margin: 0 12px;
      margin-bottom: 24px;
      transition: all 0.3s ease;
    }

    .step-indicator.completed ~ .step-line {
      background: #10B981;
    }

    /* Form Step Styles */
    .form-step {
      display: none;
    }

    .form-step.active {
      display: block;
      animation: fadeIn 0.3s ease-in;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Form Container */
    .form-container {
      background: var(--color-surface);
      border-radius: var(--radius-lg);
      padding: 2.5rem;
      border: 1px solid var(--color-border);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    @media (max-width: 768px) {
      .form-container {
        padding: 1.5rem;
      }
    }

    /* Form Elements */
    .form-section-title {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--color-text);
      margin-bottom: 2rem;
    }

    .form-section {
      display: flex;
      flex-direction: column;
      gap: 2rem;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1.5rem;
    }

    @media (max-width: 768px) {
      .form-grid {
        grid-template-columns: 1fr;
      }
    }

    .form-group,
    .form-group-full {
      display: flex;
      flex-direction: column;
    }

    .form-label {
      font-size: 0.9375rem;
      font-weight: 500;
      color: var(--color-text);
      margin-bottom: 0.625rem;
    }

    .required {
      color: #ef4444;
    }

    .form-hint {
      font-size: 0.875rem;
      color: var(--color-text-muted);
      margin-bottom: 0.75rem;
      line-height: 1.5;
    }

    .form-input,
    .form-textarea {
      width: 100%;
      padding: 0.875rem 1rem;
      background: var(--color-bg);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      color: var(--color-text);
      font-size: 0.9375rem;
      transition: all 0.2s ease;
    }

    .form-input::placeholder,
    .form-textarea::placeholder {
      color: var(--color-text-muted);
      opacity: 0.6;
    }

    .form-input:focus,
    .form-textarea:focus {
      outline: none;
      border-color: var(--color-primary);
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .form-input.input-error,
    .form-textarea.input-error {
      border-color: #ef4444;
      box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
    }

    .form-textarea {
      resize: vertical;
      min-height: 150px;
    }

    .char-counter {
      text-align: right;
      font-size: 0.875rem;
      color: var(--color-text-muted);
      margin-top: 0.5rem;
    }

    /* Selection Grids */
    .selection-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1rem;
    }

    .selection-grid-budget {
      grid-template-columns: repeat(3, 1fr);
    }

    @media (max-width: 768px) {
      .selection-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .selection-grid-budget {
        grid-template-columns: 1fr;
      }
    }

    /* Project Type & Selection Cards */
    .project-type-card,
    .timeline-card,
    .budget-card {
      cursor: pointer;
    }

    .project-type-card .card-content,
    .timeline-card .card-content,
    .budget-card .card-content {
      padding: 0.875rem 1rem;
      background: var(--color-bg);
      border: 2px solid var(--color-border);
      border-radius: var(--radius-md);
      text-align: center;
      color: var(--color-text);
      font-weight: 600;
      font-size: 0.875rem;
      transition: all 0.2s ease;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 80px;
    }

    .card-icon {
      width: 1rem !important;
      height: 1rem !important;
      margin-bottom: 0.5rem;
      color: var(--color-primary);
      flex-shrink: 0;
    }

    /* More specific selector to override any conflicts */
    .project-type-card .card-content .card-icon,
    .timeline-card .card-content .card-icon,
    .budget-card .card-content .card-icon {
      width: 1rem !important;
      height: 1rem !important;
      max-width: 1rem;
      max-height: 1rem;
    }

    .budget-text {
      font-size: 0.875rem;
      line-height: 1.4;
      text-align: center;
    }

    .project-type-card:hover .card-content,
    .timeline-card:hover .card-content,
    .budget-card:hover .card-content {
      border-color: var(--color-primary);
      background: var(--color-surface);
      transform: translateY(-2px);
    }

    .project-type-card input:checked ~ .card-content,
    .timeline-card input:checked ~ .card-content,
    .budget-card input:checked ~ .card-content {
      border-color: var(--color-primary);
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(118, 75, 162, 0.15));
      color: var(--color-text);
      box-shadow: 0 0 20px rgba(102, 126, 234, 0.2);
    }

    /* Form Actions */
    .form-actions {
      display: flex;
      justify-content: flex-end;
      margin-top: 2rem;
      gap: 1rem;
    }

    .form-actions-split {
      justify-content: space-between;
    }

    .btn-submit {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* Tech Stack Badges */
    .tech-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: linear-gradient(135deg, rgba(147, 51, 234, 0.2), rgba(59, 130, 246, 0.2));
      border: 1px solid rgba(147, 51, 234, 0.3);
      border-radius: 9999px;
      color: white;
      font-size: 0.875rem;
      font-weight: 500;
    }

    /* Risk Level Badges */
    .risk-low {
      color: #10B981;
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid #10B981;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      display: inline-block;
      font-weight: 600;
    }

    .risk-medium {
      color: #F59E0B;
      background: rgba(245, 158, 11, 0.1);
      border: 1px solid #F59E0B;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      display: inline-block;
      font-weight: 600;
    }

    .risk-high {
      color: #EF4444;
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid #EF4444;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      display: inline-block;
      font-weight: 600;
    }

    /* Prose styles for AI analysis */
    .prose p {
      margin-bottom: 1rem;
      line-height: 1.75;
    }

    .prose ul {
      list-style: disc;
      margin-left: 1.5rem;
      margin-bottom: 1rem;
    }

    .prose li {
      margin-bottom: 0.5rem;
    }

    /* CTA Section Styling */
    .cta-section {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);
      border: 1px solid rgba(102, 126, 234, 0.3);
      border-radius: var(--radius-lg);
      padding: 3rem 2rem;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .cta-section::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(102, 126, 234, 0.1) 0%, transparent 70%);
      animation: pulse 8s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% {
        transform: scale(1);
        opacity: 0.5;
      }
      50% {
        transform: scale(1.1);
        opacity: 0.8;
      }
    }

    .cta-title {
      font-size: 2rem;
      font-weight: 700;
      color: var(--color-text);
      margin-bottom: 1rem;
      position: relative;
      z-index: 1;
    }

    .cta-subtitle {
      font-size: 1.125rem;
      color: var(--color-text-muted);
      margin-bottom: 2rem;
      position: relative;
      z-index: 1;
    }

    .cta-buttons {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      justify-content: center;
      position: relative;
      z-index: 1;
    }

    @media (min-width: 640px) {
      .cta-buttons {
        flex-direction: row;
      }
    }

    /* Professional Button Styles */
    .cta-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.75rem;
      padding: 1rem 2rem;
      font-size: 1rem;
      font-weight: 600;
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      border: none;
      text-decoration: none;
    }

    .cta-btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    .cta-btn:hover::before {
      width: 300px;
      height: 300px;
    }

    .cta-btn svg {
      transition: transform 0.3s ease;
      position: relative;
      z-index: 1;
    }

    .cta-btn span,
    .cta-btn:not(svg) {
      position: relative;
      z-index: 1;
    }

    /* Primary Button (Consultation) */
    .cta-btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .cta-btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
    }

    .cta-btn-primary:hover svg {
      transform: scale(1.1) rotate(5deg);
    }

    .cta-btn-primary:active {
      transform: translateY(0);
    }

    /* Download Button */
    .cta-btn-download {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.15) 100%);
      border: 2px solid var(--color-primary);
      color: var(--color-text);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .cta-btn-download:hover {
      transform: translateY(-2px);
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.25) 0%, rgba(118, 75, 162, 0.25) 100%);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
      border-color: #667eea;
    }

    .cta-btn-download:hover .download-icon {
      animation: downloadBounce 0.6s ease-in-out infinite;
    }

    @keyframes downloadBounce {
      0%, 100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(5px);
      }
    }

    /* New Estimate Button */
    .new-estimate-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      background: rgba(102, 126, 234, 0.1);
      border: 1px solid rgba(102, 126, 234, 0.3);
      border-radius: var(--radius-md);
      color: var(--color-primary);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .new-estimate-btn:hover {
      background: rgba(102, 126, 234, 0.2);
      border-color: var(--color-primary);
      color: #667eea;
      transform: translateX(-5px);
    }

    .new-estimate-btn svg {
      transition: transform 0.3s ease;
    }

    .new-estimate-btn:hover svg {
      transform: rotate(-180deg);
    }

    /* Responsive adjustments */
    @media (max-width: 640px) {
      .cta-section {
        padding: 2rem 1.5rem;
      }

      .cta-title {
        font-size: 1.5rem;
      }

      .cta-subtitle {
        font-size: 1rem;
      }

      .cta-btn {
        padding: 0.875rem 1.5rem;
        font-size: 0.9375rem;
      }
    }

    /* Hidden utility class - ensure sections are hidden by default */
    .hidden {
      display: none !important;
    }
  </style>

  <!-- jsPDF Library for PDF Generation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    let currentStep = 1;
    const totalSteps = 3;
    let currentEstimateData = null; // Store estimate data for PDF generation

    // Character counter
    const textarea = document.getElementById('project_description');
    const charCount = document.getElementById('charCount');

    if (textarea && charCount) {
      textarea.addEventListener('input', () => {
        charCount.textContent = textarea.value.length;
      });
    }

    // Step navigation
    function updateStepIndicators() {
      document.querySelectorAll('.step-indicator').forEach((indicator, index) => {
        const stepNum = index + 1;
        indicator.classList.remove('active', 'completed');

        if (stepNum < currentStep) {
          indicator.classList.add('completed');
        } else if (stepNum === currentStep) {
          indicator.classList.add('active');
        }
      });

      document.querySelectorAll('.form-step').forEach((step, index) => {
        step.classList.remove('active');
        if (index + 1 === currentStep) {
          step.classList.add('active');
        }
      });
    }

    // Next button handlers
    document.querySelectorAll('.next-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const currentStepElement = document.querySelector(`.form-step[data-step="${currentStep}"]`);
        const inputs = currentStepElement.querySelectorAll('input[required], textarea[required]');
        let valid = true;

        inputs.forEach(input => {
          if (!input.value.trim() || (input.type === 'radio' && !currentStepElement.querySelector(`input[name="${input.name}"]:checked`))) {
            valid = false;
            input.classList.add('input-error');
          } else {
            input.classList.remove('input-error');
          }
        });

        if (valid && currentStep < totalSteps) {
          currentStep++;
          updateStepIndicators();
          window.scrollTo({ top: 0, behavior: 'smooth' });
        }
      });
    });

    // Previous button handlers
    document.querySelectorAll('.prev-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        if (currentStep > 1) {
          currentStep--;
          updateStepIndicators();
          window.scrollTo({ top: 0, behavior: 'smooth' });
        }
      });
    });

    // Form submission
    const form = document.getElementById('estimateForm');
    const loadingState = document.getElementById('loadingState');
    const resultsContainer = document.getElementById('resultsContainer');
    const progressBar = document.getElementById('progressBar');
    const progressText = document.getElementById('progressText');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Hide form, show loading
      form.style.display = 'none';
      loadingState.classList.remove('hidden');

      // Animate progress bar
      const progressSteps = [
        { width: 25, text: 'Analyzing project requirements...' },
        { width: 50, text: 'Evaluating complexity and scope...' },
        { width: 75, text: 'Calculating estimates and recommendations...' },
        { width: 100, text: 'Finalizing your estimate...' }
      ];

      let stepIndex = 0;
      const progressInterval = setInterval(() => {
        if (stepIndex < progressSteps.length) {
          progressBar.style.width = `${progressSteps[stepIndex].width}%`;
          progressText.textContent = progressSteps[stepIndex].text;
          stepIndex++;
        }
      }, 1500);

      try {
        const formData = new FormData(form);
        const data = Object.fromEntries(formData);

        const response = await fetch('/api/estimate-project', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data),
        });

        const result = await response.json();

        clearInterval(progressInterval);
        progressBar.style.width = '100%';

        if (response.ok) {
          // Display results
          setTimeout(() => {
            loadingState.classList.add('hidden');
            resultsContainer.classList.remove('hidden');
            displayResults(result);
            window.scrollTo({ top: 0, behavior: 'smooth' });
          }, 1000);
        } else {
          throw new Error(result.message || 'Failed to generate estimate');
        }
      } catch (error) {
        clearInterval(progressInterval);
        alert('Sorry, there was an error generating your estimate. Please try again or contact us directly.');
        loadingState.classList.add('hidden');
        form.style.display = 'block';
        console.error('Error:', error);
      }
    });

    function displayResults(data) {
      // Store estimate data globally for PDF generation
      currentEstimateData = data;

      // Store client information for PDF
      const formData = new FormData(form);
      currentEstimateData.clientName = formData.get('name');
      currentEstimateData.clientEmail = formData.get('email');
      currentEstimateData.clientCompany = formData.get('company');

      const exchangeRate = 12; // 1 USD = 12 GH₵

      // Helper function to format dual currency
      const formatDualCurrency = (usd) => {
        const cedis = usd * exchangeRate;
        return `GH₵${cedis.toLocaleString()} ($${usd.toLocaleString()})`;
      };

      // Cost Range
      const minCedis = (data.estimated_cost_min || 0) * exchangeRate;
      const maxCedis = (data.estimated_cost_max || 0) * exchangeRate;
      document.getElementById('costRange').textContent =
        `GH₵${minCedis.toLocaleString()} - GH₵${maxCedis.toLocaleString()} ($${(data.estimated_cost_min || 0).toLocaleString()} - $${(data.estimated_cost_max || 0).toLocaleString()})`;

      // Timeline
      document.getElementById('timeline').textContent =
        `${data.estimated_timeline_weeks || 0} weeks`;

      // Team Size
      document.getElementById('teamSize').textContent =
        `${data.team_size_needed || 0} ${data.team_size_needed === 1 ? 'person' : 'people'}`;

      // Technology Stack
      const techStack = document.getElementById('techStack');
      if (data.technology_stack && data.technology_stack.length > 0) {
        techStack.innerHTML = data.technology_stack
          .map(tech => `<span class="tech-badge">${tech}</span>`)
          .join('');
      } else {
        techStack.innerHTML = '<span class="text-gray-400">To be determined based on detailed requirements</span>';
      }

      // Risk Level
      const riskLevel = document.getElementById('riskLevel');
      const riskClass = `risk-${data.risk_level || 'medium'}`;
      riskLevel.innerHTML = `<span class="${riskClass}">${(data.risk_level || 'medium').toUpperCase()} RISK</span>`;

      // AI Analysis
      const aiAnalysis = document.getElementById('aiAnalysis');
      if (data.ai_analysis && data.ai_analysis.summary) {
        aiAnalysis.innerHTML = formatAnalysis(data.ai_analysis.summary);
      } else {
        aiAnalysis.innerHTML = '<p>Analysis details will be provided in your consultation.</p>';
      }

      // Store estimate ID for PDF download
      if (data.id) {
        document.getElementById('downloadPdfBtn').dataset.estimateId = data.id;
      }
    }

    function formatAnalysis(text) {
      // Convert line breaks and basic formatting
      return text
        .replace(/\n\n/g, '</p><p>')
        .replace(/\n/g, '<br>')
        .replace(/^/, '<p>')
        .replace(/$/, '</p>');
    }

    // New estimate button
    document.getElementById('newEstimateBtn')?.addEventListener('click', () => {
      currentStep = 1;
      updateStepIndicators();
      form.reset();
      form.style.display = 'block';
      resultsContainer.classList.add('hidden');
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    // PDF Download - Generate professional PDF with estimate details
    document.getElementById('downloadPdfBtn')?.addEventListener('click', () => {
      if (!currentEstimateData) {
        alert('No estimate data available. Please generate an estimate first.');
        return;
      }

      try {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const exchangeRate = 12;

        // Set up colors
        const primaryColor = [102, 126, 234]; // Purple
        const secondaryColor = [118, 75, 162]; // Darker purple
        const textColor = [51, 51, 51];
        const grayColor = [128, 128, 128];

        let yPos = 20;
        const lineHeight = 7;
        const pageWidth = doc.internal.pageSize.getWidth();
        const pageHeight = doc.internal.pageSize.getHeight();
        const margin = 20;
        const contentWidth = pageWidth - (margin * 2);

        // Header with gradient effect
        doc.setFillColor(...primaryColor);
        doc.rect(0, 0, pageWidth, 50, 'F');

        // Company Logo/Branding (Hodges & Co.)
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(18);
        doc.setFont('helvetica', 'bold');
        doc.text('Hodges & Co.', margin, 15);

        // Title
        doc.setFontSize(24);
        doc.setFont('helvetica', 'bold');
        doc.text('PROJECT ESTIMATE', pageWidth / 2, 28, { align: 'center' });

        doc.setFontSize(11);
        doc.setFont('helvetica', 'normal');
        doc.text('AI-Powered Analysis & Recommendations', pageWidth / 2, 38, { align: 'center' });

        yPos = 60;

        // Client Information Section
        doc.setTextColor(...textColor);
        doc.setFontSize(12);
        doc.setFont('helvetica', 'bold');
        doc.text('Prepared for:', margin, yPos);
        yPos += lineHeight;

        doc.setFontSize(11);
        doc.setFont('helvetica', 'normal');
        doc.text(currentEstimateData.clientName || 'N/A', margin, yPos);
        yPos += lineHeight - 1;

        if (currentEstimateData.clientCompany) {
          doc.setTextColor(...grayColor);
          doc.setFontSize(10);
          doc.text(currentEstimateData.clientCompany, margin, yPos);
          yPos += lineHeight - 1;
        }

        doc.setTextColor(...grayColor);
        doc.setFontSize(9);
        doc.text(currentEstimateData.clientEmail || '', margin, yPos);
        yPos += lineHeight;

        // Date
        doc.setTextColor(...grayColor);
        doc.setFontSize(10);
        doc.text(`Generated: ${new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}`, margin, yPos);
        yPos += lineHeight * 2;

        // Cost Estimate Section
        doc.setTextColor(...primaryColor);
        doc.setFontSize(14);
        doc.setFont('helvetica', 'bold');
        doc.text('ESTIMATED INVESTMENT', margin, yPos);
        yPos += lineHeight;

        doc.setDrawColor(...primaryColor);
        doc.setLineWidth(0.5);
        doc.line(margin, yPos, pageWidth - margin, yPos);
        yPos += lineHeight;

        doc.setTextColor(...textColor);
        doc.setFontSize(11);
        doc.setFont('helvetica', 'normal');
        const minCedis = (currentEstimateData.estimated_cost_min || 0) * exchangeRate;
        const maxCedis = (currentEstimateData.estimated_cost_max || 0) * exchangeRate;
        doc.text(`GHS ${minCedis.toLocaleString()} - GHS ${maxCedis.toLocaleString()}`, margin, yPos);
        doc.setTextColor(...grayColor);
        doc.setFontSize(9);
        doc.text(`($${(currentEstimateData.estimated_cost_min || 0).toLocaleString()} - $${(currentEstimateData.estimated_cost_max || 0).toLocaleString()} USD)`, margin, yPos + 5);
        yPos += lineHeight * 3;

        // Timeline Section
        doc.setTextColor(...primaryColor);
        doc.setFontSize(14);
        doc.setFont('helvetica', 'bold');
        doc.text('PROJECT TIMELINE', margin, yPos);
        yPos += lineHeight;

        doc.setDrawColor(...primaryColor);
        doc.line(margin, yPos, pageWidth - margin, yPos);
        yPos += lineHeight;

        doc.setTextColor(...textColor);
        doc.setFontSize(11);
        doc.setFont('helvetica', 'normal');
        doc.text(`${currentEstimateData.estimated_timeline_weeks || 0} weeks`, margin, yPos);
        yPos += lineHeight * 2;

        // Team Size Section
        doc.setTextColor(...primaryColor);
        doc.setFontSize(14);
        doc.setFont('helvetica', 'bold');
        doc.text('TEAM COMPOSITION', margin, yPos);
        yPos += lineHeight;

        doc.setDrawColor(...primaryColor);
        doc.line(margin, yPos, pageWidth - margin, yPos);
        yPos += lineHeight;

        doc.setTextColor(...textColor);
        doc.setFontSize(11);
        doc.setFont('helvetica', 'normal');
        doc.text(`${currentEstimateData.team_size_needed || 0} ${currentEstimateData.team_size_needed === 1 ? 'person' : 'people'}`, margin, yPos);
        yPos += lineHeight * 2;

        // Technology Stack Section
        doc.setTextColor(...primaryColor);
        doc.setFontSize(14);
        doc.setFont('helvetica', 'bold');
        doc.text('RECOMMENDED TECHNOLOGY STACK', margin, yPos);
        yPos += lineHeight;

        doc.setDrawColor(...primaryColor);
        doc.line(margin, yPos, pageWidth - margin, yPos);
        yPos += lineHeight;

        doc.setTextColor(...textColor);
        doc.setFontSize(10);
        doc.setFont('helvetica', 'normal');
        if (currentEstimateData.technology_stack && currentEstimateData.technology_stack.length > 0) {
          const techStackText = currentEstimateData.technology_stack.join(', ');
          const techLines = doc.splitTextToSize(techStackText, contentWidth);
          doc.text(techLines, margin, yPos);
          yPos += (techLines.length * lineHeight) + lineHeight;
        } else {
          doc.text('To be determined based on detailed requirements', margin, yPos);
          yPos += lineHeight * 2;
        }

        // Risk Level Section
        doc.setTextColor(...primaryColor);
        doc.setFontSize(14);
        doc.setFont('helvetica', 'bold');
        doc.text('RISK ASSESSMENT', margin, yPos);
        yPos += lineHeight;

        doc.setDrawColor(...primaryColor);
        doc.line(margin, yPos, pageWidth - margin, yPos);
        yPos += lineHeight;

        const riskLevel = (currentEstimateData.risk_level || 'medium').toUpperCase();
        const riskColor = riskLevel === 'LOW' ? [16, 185, 129] : riskLevel === 'HIGH' ? [239, 68, 68] : [245, 158, 11];
        doc.setTextColor(...riskColor);
        doc.setFontSize(11);
        doc.setFont('helvetica', 'bold');
        doc.text(`${riskLevel} RISK`, margin, yPos);
        yPos += lineHeight * 2;

        // Check if we need a new page
        if (yPos > pageHeight - 60) {
          doc.addPage();
          yPos = 20;
        }

        // Summary Section
        if (currentEstimateData.summary) {
          doc.setTextColor(...primaryColor);
          doc.setFontSize(14);
          doc.setFont('helvetica', 'bold');
          doc.text('PROJECT ANALYSIS', margin, yPos);
          yPos += lineHeight;

          doc.setDrawColor(...primaryColor);
          doc.line(margin, yPos, pageWidth - margin, yPos);
          yPos += lineHeight;

          doc.setTextColor(...textColor);
          doc.setFontSize(10);
          doc.setFont('helvetica', 'normal');

          // Clean up the summary text
          const summaryText = currentEstimateData.summary.replace(/<[^>]*>/g, '').replace(/\n+/g, '\n').trim();
          const summaryLines = doc.splitTextToSize(summaryText, contentWidth);

          // Add summary with automatic page breaks
          for (let i = 0; i < summaryLines.length; i++) {
            if (yPos > pageHeight - 30) {
              doc.addPage();
              yPos = 20;
            }
            doc.text(summaryLines[i], margin, yPos);
            yPos += lineHeight;
          }
          yPos += lineHeight;
        }

        // Footer
        const footerY = pageHeight - 25;

        // Company name in footer
        doc.setFontSize(9);
        doc.setTextColor(...primaryColor);
        doc.setFont('helvetica', 'bold');
        doc.text('Hodges & Co.', pageWidth / 2, footerY, { align: 'center' });

        // Footer disclaimers
        doc.setFontSize(8);
        doc.setTextColor(...grayColor);
        doc.setFont('helvetica', 'italic');
        doc.text('This is an AI-generated estimate. Final pricing may vary based on detailed requirements.', pageWidth / 2, footerY + 5, { align: 'center' });
        doc.text('Contact us for a detailed consultation and custom proposal.', pageWidth / 2, footerY + 10, { align: 'center' });

        // Page numbers on all pages
        const pageCount = doc.internal.getNumberOfPages();
        for (let i = 1; i <= pageCount; i++) {
          doc.setPage(i);
          doc.setFontSize(8);
          doc.setTextColor(...grayColor);
          doc.text(`Page ${i} of ${pageCount}`, pageWidth - margin, pageHeight - 10, { align: 'right' });
        }

        // Save the PDF
        const fileName = `Project_Estimate_${new Date().toISOString().split('T')[0]}.pdf`;
        doc.save(fileName);

      } catch (error) {
        console.error('PDF Generation Error:', error);
        alert('There was an error generating the PDF. Please try again or contact us directly.');
      }
    });

    // Initialize
    updateStepIndicators();
  </script>
</BaseLayout>
